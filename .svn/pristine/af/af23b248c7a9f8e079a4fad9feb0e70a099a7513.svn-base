<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/lib/Hui-iconfont/1.0.7/iconfont.css" />
<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/lib/icheck/icheck.css" />
<title>祝福卡维护</title>
</head>
<body>
   <div style=" margin-left: 10px;margin-right: 10px;">
    <form class="form form-horizontal">
     <!-- 编辑奖品-->
     <#if rd??>
          <table class="table table-border table-bordered table-hover table-bg table-sort f-l mt-15">
				<tr style=" display: none">
					<td>卡片ID号</td>
					<td><input type="text" class="input-text size-S" id="vId" name="id" value="${rd.id!}"></td>
				</tr>
				<tr>
					<td width="120">卡片名称</td>
					<td><input type="text" class="input-text size-S" id="vname" name="name" value="${rd.name!}"></td>
				</tr>
				
				<tr>
  					<td>卡片分类</td>
  					<td>
						<span class="select-box" id="vtypeId">
						  	<select class="select" size="1" name="typeId">
						    	<option value="0" selected>--选择卡片分类--</option>
						    	<#list dicList as dic>
						    	<#if rd?? && dic.code_value==rd.typeId>
						    	<option value=${dic.code_value} selected>${dic.code_name}</option>
						    	<#else>
						    	<option value=${dic.code_value}>${dic.code_name}</option>
						    	</#if>
						    	</#list>
						  	</select>
						</span>
  					</td>
  				</tr>
				
  				<tr>
  				   <td width="120">卡面图片：</td>
  				   <td><span class="btn-upload form-group" style="width: calc(100% - 26px)">
							<input class="input-text upload-url" type="text" id="imgurl01" value="${rd.imgurl01!}" readonly style="display:block;float:left;margin-right:5px;width:calc(100% - 116px)">
							<a href="javascript:void();" class="btn btn-primary upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
							<input type="file" multiple name="file" class="input-file">
							<input type="hidden" name="imgurl01" class="pro-imgsrc">
						</span>
						<i class="Hui-iconfont f-20" title="预览" style="cursor: pointer;" onclick="parent.showimgage('${rd.imgurl01!}')">&#xe695;</i></td>
  				</tr>
  				<tr>
					<td width="120">状态：0不显示1显示</td>
					<td><input type="text" class="input-text size-S" id="vstate" name="state" value="${rd.state!}"></td>
  				</tr>	
  				<tr>
					<td width="120">排序序号：</td>
					<td><input type="text" class="input-text size-S" id="vimgOrderId" name="imgOrderId" value="${rd.imgOrderId!1}"></td>
  				</tr>	
			</table>
			<input type="button" onClick="editsave()" class="btn btn-primary btn-block" value="编辑保存">
       
  <!-- 添加卡片-->
   <#else> 
       <table class="table table-border table-bordered table-hover table-bg table-sort f-l mt-15">
				<tr>
					<td width="120">卡片名称</td>
					<td><input type="text" class="input-text size-S" id="vname" name="name" value=""></td>
				</tr>
				
				<tr>
  					<td>卡片分类</td>
  					<td>
						<span class="select-box" id="v3">
						  	<select class="select" size="1" name="typeId">
						    	<option value="0" selected>--选择卡片分类--</option>
						    	<#list dicList as dic>
						    	  <option value=${dic.code_value}>${dic.code_name}</option>
						    	</#list>
						  	</select>
						</span>
  					</td>
  				</tr>
				
  				<tr>
  				   <td width="120">卡面图片：</td>
  				   <td><span class="btn-upload form-group" style="width: calc(100% - 26px)">
							<input class="input-text upload-url" type="text" id="imgurl01" value="" readonly style="display:block;float:left;margin-right:5px;width:calc(100% - 116px)">
							<a href="javascript:void();" class="btn btn-primary upload-btn"><i class="Hui-iconfont">&#xe642;</i> 浏览文件</a>
							<input type="file" multiple name="file" class="input-file">
							<input type="hidden" name="imgurl01" class="pro-imgsrc">
						</span>
  				</tr>
  				<tr>
					<td width="120">状态：0不显示1显示</td>
					<td><input type="text" class="input-text size-S" id="vstate" name="state" value="0"></td>
  				</tr>
  				<tr>
					<td width="120">排序序号：</td>
					<td><input type="text" class="input-text size-S" id="vimgOrderId" name="imgOrderId" value="1"></td>
  				</tr>	
						
	   </table>
	   <input type="button" onClick="addsave()" class="btn btn-primary btn-block mt-15" value="新增保存">
     </#if>
     </form>
   </div>
   
   
  <script type="text/javascript" src="/resource/flower/js/jquery.min.js"></script>
  <script type="text/javascript" src="/resource/flower/js/jquery.nicescroll.min.js"></script>
  <script type="text/javascript" src="/resource/layer/layer.js"></script>
  <script type="text/javascript" src="/resource/H-ui.admin_v2.5/static/h-ui/js/H-ui.js"></script> 
  <script type="text/javascript" src="/resource/H-ui.admin_v2.5/static/h-ui.admin/js/H-ui.admin.js"></script>
  <script type="text/javascript">
    //图片生成新地址
	 $('.input-file').on('change', function(){
		var $proImg = $(this).siblings(".pro-imgsrc");
		var reader = new FileReader();
		reader.onload = function(e) {
			var base64 = e.target.result;
			$proImg.val(base64);
		};
		reader.readAsDataURL(this.files[0]);
		this.files = [];
	}); 
	
		
	function addsave() {
		var lock = true;
		if(lock){
			lock = false;
			var load = layer.load();
			$.post('/manage/iframe/cardpic/SaveWishCard', $('form').serialize(), function(data){
				layer.close(load);
				if(data.result){
					parent.refresh_iframe();
					layer.msg('新增成功', {time: 1000}, function(){
						layer_close();
					});
				}else{
					layer.msg('新增失败', {time: 1000}, function(){
						lock = true;
					});
				}
			});
		}
	}
	function editsave(){
		var lock = true;
		if(lock){
			lock = false;
			var load = layer.load();
			$.post('/manage/iframe/cardpic/EditWishCard', $('form').serialize(), function(data){
				layer.close(load);
				if(data.result){
					parent.refresh_iframe();
					layer.msg('编辑成功', {time: 1000}, function(){
						layer_close();
					});
				}else{
					layer.msg('编辑失败', {time: 1000}, function(){
						lock = true;
					});
				}
			});
		}
	}
	
		
		
		
		
		 
		
	
	
  </script>
   
          

</body>
</html>