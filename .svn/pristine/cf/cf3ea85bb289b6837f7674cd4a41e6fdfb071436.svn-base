<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit|ie-comp|ie-stand">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<!--[if lt IE 9]>
			<script type="text/javascript" src="/resource/H-ui.admin_v2.5/lib/html5.js"></script>
			<script type="text/javascript" src="/resource/H-ui.admin_v2.5/lib/respond.min.js"></script>
			<script type="text/javascript" src="/resource/H-ui.admin_v2.5/lib/PIE_IE678.js"></script>
		<![endif]-->
		<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/static/h-ui/css/H-ui.min.css" />
		<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/static/h-ui.admin/css/H-ui.admin.css" />
		<link rel="stylesheet" type="text/css" href="/resource/H-ui.admin_v2.5/lib/Hui-iconfont/1.0.7/iconfont.css" />
		<style type="text/css">
         .alladdr:hover {overflow:visible;position: absolute;font-weight: bolder;}
		</style>
		<title>红包管理 - 红包列表 - 红包详情</title>
	</head>
	<body>
	     <div class="page-container">
	     <div class="mt-10">
			<table class="table table-border table-bordered table-hover table-bg table-sort" id = "table">
				<thead>
					<tr class="text-c">
					  <th width="80">红包Id号</th>
					  <th width="80">发包人昵称</th>
					  <th width="80">未拆包金额</th>
					  <th width="80">退款金额</th>
					 <!--  <th width="80"></th> -->
					  <th width="80"></th>
					</tr>
				</thead>
				<tbody>
					<#if list?? && list?size gt 0>
					     <#list list as li>
					       <tr class="text-c">
					         <td>${li.id}</td>
						     <td>${li.nick}</td>
						     <td >${li.money}</td>
						     <td >${li.tmoney}</td>
						  <!--    <td><input type="button" value ="编辑退款金额" id = "change" ></input></td> -->
						     <td><input type="button" value ="提交退款" id = "submit" ></input></td>
					      </tr>
					    </#list>
					<#else>
					    <tr>
						   <td colspan="16" style="text-align: center;"><span>没有数据信息</span></td>
					    </tr>
					</#if>
				</tbody>		     
			</table>
			<div class="mt-10 text-r" id="forpage"></div>
			</div>
	     
			
			
		</div>
		
		 
		<script type="text/javascript" src="/resource/flower/js/jquery.min.js"></script>
		<script type="text/javascript" src="/resource/layer/layer.js"></script>
		<script type="text/javascript" src="/resource/laypage/laypage.js"></script>
		<script type="text/javascript" src="/resource/H-ui.admin_v2.5/static/h-ui/js/H-ui.js"></script>
		<script type="text/javascript" src="/resource/flower/js/jquery.nicescroll.min.js"></script>
		<script type="text/javascript" src="/resource/H-ui.admin_v2.5/static/h-ui.admin/js/H-ui.admin.js"></script>
		<script type="text/javascript">
			$(document).ready(function(){
				$("html").niceScroll({
					cursorcolor:"#333",
					cursoropacitymin: 0.6,
					cursoropacitymax:0.6,
					demode: false
				});
				$("#submit").click(function(){
					 if ($(this).parent().siblings("td")[3].children.length!=0){
						 alert("请确认退款金额！");
						 return;
					 }
					 ttime = getNowFormatDate();
					 id =$.trim($(this).parent().siblings("td")[0].innerText);
					 money=$.trim($(this).parent().siblings("td")[2].innerText);
					 tmoney=$.trim($(this).parent().siblings("td")[3].innerText);
					 money= parseFloat(money);
					 tmoney=parseFloat(tmoney);
					 if(money<tmoney){
						 alert("退款金额不能大于未拆包金额！");
						 return;
					 }			
						var lock = true;
						if(lock){
							lock = false;
							$.post('/manage/iframe/redpackets/BackMoney2',{'id':id,'tmoney':tmoney,'ttime':ttime}, function(data){
								if(data.result){
									parent.refresh_iframe();
									layer.msg('退款成功', {time: 1000}, function(){
										layer_close();
									});
								}else{
									layer.msg('退款失败', {time: 1000}, function(){
										lock = true;
									});
								}
							});
						}
					
					
				})
				$("#change").click(function() {
				        str = $(this).val()=="编辑退款金额"?"确定":"编辑退款金额";  
				        $(this).val(str);   // 按钮被点击后，在“编辑退款金额”和“确定”之间切换
				        b =  $(this).parent();
				        a = $(this).parent().siblings("td");
				        c = a[3].children.length;
				         if(c===0){
				            a[3].innerHTML="<input type='text' value='"+a[3].innerText+"'/>";
				         }else{
				           $(this).parent().siblings("td").each(function() {  // 获取当前行的其他单元格				        
				            obj_text = $(this).find("input:text");    // 判断单元格下是否有文本框
				            $(this).html(obj_text.val()); 
				        });   
				        }
				    });
				function getNowFormatDate() {
				    var date = new Date();
				    var seperator1 = "-";
				    var seperator2 = ":";
				    var month = date.getMonth() + 1;
				    var strDate = date.getDate();
				    if (month >= 1 && month <= 9) {
				        month = "0" + month;
				    }
				    if (strDate >= 0 && strDate <= 9) {
				        strDate = "0" + strDate;
				    }
				    var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
				            + " " + date.getHours() + seperator2 + date.getMinutes()
				            + seperator2 + date.getSeconds();
				    return currentdate;
				}
			});
		</script>
	</body>
</html>